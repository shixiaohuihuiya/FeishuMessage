# 飞书每日消息提醒  github actions 版本

name: Feishu Daily Reminders with Signature

on:
  schedule:
    - cron: '0 1 * * *'   # UTC 1:00 (北京时间9:00)
    - cron: '0 7 * * *'   # UTC 7:00 (北京时间15:00)
  workflow_dispatch:

jobs:
  send-feishu-message:
    runs-on: ubuntu-latest
    
    steps:
    - name: Setup signature for morning reminder
      if: github.event.schedule == '0 1 * * *'
      id: sign_morning
      run: |
        TIMESTAMP=$(date +%s)
        SIGN=$(printf "$TIMESTAMP\n${{ secrets.FEISHU_SIGN_SECRET }}" | openssl dgst -sha256 -hex | awk '{print $2}')
        echo "TIMESTAMP=$TIMESTAMP" >> $GITHUB_ENV
        echo "SIGN=$SIGN" >> $GITHUB_ENV
        
    - name: Send morning reminder
      if: github.event.schedule == '0 1 * * *'
      run: |
        curl -X POST \
          ${{ secrets.FEISHU_WEBHOOK_URL }} \
          -H 'Content-Type: application/json' \
          -H "X-Lark-Signature: $SIGN" \
          -H "X-Lark-Request-Timestamp: $TIMESTAMP" \
          -d '{
            "msg_type": "interactive",
            "card": {
              "elements": [{
                  "tag": "div",
                  "text": {
                    "tag": "lark_md",
                    "content": "⏰ **上午工作提醒**\n\n美好的一天开始啦！\n• 检查今日工作计划\n• 今天有60表要上传吗？\n• 开始专注工作\n• 记得补充水分 💧"
                  }
                },
                {
                  "tag": "hr"
                },
                {
                  "tag": "div",
                  "text": {
                    "tag": "lark_md",
                    "content": "**今日提醒：**\n• 完成主要任务\n• 60表上传了吗？"
                  }
                }
              ],
              "header": {
                "template": "blue",
                "title": {
                  "content": "🌞 早安提醒 | ",
                  "tag": "plain_text"
                }
              }
            }
          }'
      
    - name: Setup signature for afternoon reminder
      if: github.event.schedule == '0 7 * * *'
      id: sign_afternoon
      run: |
        TIMESTAMP=$(date +%s)
        SIGN=$(printf "$TIMESTAMP\n${{ secrets.FEISHU_SIGN_SECRET }}" | openssl dgst -sha256 -hex | awk '{print $2}')
        echo "TIMESTAMP=$TIMESTAMP" >> $GITHUB_ENV
        echo "SIGN=$SIGN" >> $GITHUB_ENV
        
    - name: Send afternoon reminder
      if: github.event.schedule == '0 7 * * *'
      run: |
        curl -X POST \
          ${{ secrets.FEISHU_WEBHOOK_URL }} \
          -H 'Content-Type: application/json' \
          -H "X-Lark-Signature: $SIGN" \
          -H "X-Lark-Request-Timestamp: $TIMESTAMP" \
          -d '{
            "msg_type": "interactive",
            "card": {
              "elements": [{
                  "tag": "div",
                  "text": {
                    "tag": "lark_md",
                    "content": "☕ **下午工作提醒**\n\n下午时光，继续加油！\n• 今天60张表是否上传完成？\n• 规划下午任务安排\n• 适当休息放松\n• 保持高效状态 🚀"
                  }
                },
                {
                  "tag": "hr"
                },
                {
                  "tag": "div",
                  "text": {
                    "tag": "lark_md",
                    "content": "**进度检查：**\n• 上午任务完成情况\n• 下午重点事项\n• 明日计划准备"
                  }
                }
              ],
              "header": {
                "template": "wathet",
                "title": {
                  "content": "🌅 午后提醒 | ",
                  "tag": "plain_text"
                }
              }
            }
          }'