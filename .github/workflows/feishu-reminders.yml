name: Feishu Daily Reminder

on:
  workflow_dispatch:  # 手动触发
  schedule:
    # 北京时间早上9点 (UTC+8) = UTC时间凌晨1点
    - cron: '0 1 * * *'
    # 北京时间下午3点 (UTC+8) = UTC时间早上7点
    - cron: '0 7 * * *'

jobs:
  send-daily-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: Debug Info
        run: |
          echo "🔍 调试信息:"
          echo "Event: ${{ github.event_name }}"
          echo "Schedule: ${{ github.event.schedule }}"
          echo "Current UTC: $(date -u)"
          echo "Current Beijing: $(TZ='Asia/Shanghai' date)"
          echo "Webhook URL configured: $([ -n '${{ secrets.FEISHU_WEBHOOK_URL }}' ] && echo 'YES' || echo 'NO')"

      - name: Simple Test Message
        run: |
          BEIJING_TIME=$(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')
          echo "⏰ 当前北京时间: $BEIJING_TIME"
          
          # 简单的测试消息
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
            "${{ secrets.FEISHU_WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            -d '{
              "msg_type": "text",
              "content": {
                "text": "测试消息 - 如果收到此消息说明机器人配置正常\n时间: '"$BEIJING_TIME"'\n触发方式: '"${{ github.event_name }}"'"
              }
            }')
          
          # 解析响应
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          RESPONSE_BODY=$(echo "$RESPONSE" | head -n -1)
          
          echo "📡 HTTP 状态码: $HTTP_CODE"
          echo "📨 响应内容: $RESPONSE_BODY"
          
          if [ "$HTTP_CODE" -eq 200 ]; then
            echo "✅ 消息发送成功！"
          else
            echo "❌ 消息发送失败"
          fi
