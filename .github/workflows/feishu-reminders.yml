# é£ä¹¦æ¯æ—¥æ¶ˆæ¯æé†’  github actions ç‰ˆæœ¬

name: Feishu Daily Reminders with Signature

on:
  schedule:
    - cron: '0 1 * * *'   # UTC 1:00 (åŒ—äº¬æ—¶é—´9:00)
    - cron: '0 7 * * *'   # UTC 7:00 (åŒ—äº¬æ—¶é—´15:00)
  workflow_dispatch:

jobs:
  send-feishu-message:
    runs-on: ubuntu-latest
    
    steps:
    - name: Setup signature for morning reminder
      if: github.event.schedule == '0 1 * * *'
      id: sign_morning
      run: |
        TIMESTAMP=$(date +%s)
        SIGN=$(printf "$TIMESTAMP\n${{ secrets.FEISHU_SIGN_SECRET }}" | openssl dgst -sha256 -hex | awk '{print $2}')
        echo "TIMESTAMP=$TIMESTAMP" >> $GITHUB_ENV
        echo "SIGN=$SIGN" >> $GITHUB_ENV
        
    - name: Send morning reminder
      if: github.event.schedule == '0 1 * * *'
      run: |
        curl -X POST \
          ${{ secrets.FEISHU_WEBHOOK_URL }} \
          -H 'Content-Type: application/json' \
          -H "X-Lark-Signature: $SIGN" \
          -H "X-Lark-Request-Timestamp: $TIMESTAMP" \
          -d '{
            "msg_type": "interactive",
            "card": {
              "elements": [{
                  "tag": "div",
                  "text": {
                    "tag": "lark_md",
                    "content": "â° **ä¸Šåˆå·¥ä½œæé†’**\n\nç¾å¥½çš„ä¸€å¤©å¼€å§‹å•¦ï¼\nâ€¢ æ£€æŸ¥ä»Šæ—¥å·¥ä½œè®¡åˆ’\nâ€¢ ä»Šå¤©æœ‰60è¡¨è¦ä¸Šä¼ å—ï¼Ÿ\nâ€¢ å¼€å§‹ä¸“æ³¨å·¥ä½œ\nâ€¢ è®°å¾—è¡¥å……æ°´åˆ† ğŸ’§"
                  }
                },
                {
                  "tag": "hr"
                },
                {
                  "tag": "div",
                  "text": {
                    "tag": "lark_md",
                    "content": "**ä»Šæ—¥æé†’ï¼š**\nâ€¢ å®Œæˆä¸»è¦ä»»åŠ¡\nâ€¢ 60è¡¨ä¸Šä¼ äº†å—ï¼Ÿ"
                  }
                }
              ],
              "header": {
                "template": "blue",
                "title": {
                  "content": "ğŸŒ æ—©å®‰æé†’ | ",
                  "tag": "plain_text"
                }
              }
            }
          }'
      
    - name: Setup signature for afternoon reminder
      if: github.event.schedule == '0 7 * * *'
      id: sign_afternoon
      run: |
        TIMESTAMP=$(date +%s)
        SIGN=$(printf "$TIMESTAMP\n${{ secrets.FEISHU_SIGN_SECRET }}" | openssl dgst -sha256 -hex | awk '{print $2}')
        echo "TIMESTAMP=$TIMESTAMP" >> $GITHUB_ENV
        echo "SIGN=$SIGN" >> $GITHUB_ENV
        
    - name: Send afternoon reminder
      if: github.event.schedule == '0 7 * * *'
      run: |
        curl -X POST \
          ${{ secrets.FEISHU_WEBHOOK_URL }} \
          -H 'Content-Type: application/json' \
          -H "X-Lark-Signature: $SIGN" \
          -H "X-Lark-Request-Timestamp: $TIMESTAMP" \
          -d '{
            "msg_type": "interactive",
            "card": {
              "elements": [{
                  "tag": "div",
                  "text": {
                    "tag": "lark_md",
                    "content": "â˜• **ä¸‹åˆå·¥ä½œæé†’**\n\nä¸‹åˆæ—¶å…‰ï¼Œç»§ç»­åŠ æ²¹ï¼\nâ€¢ ä»Šå¤©60å¼ è¡¨æ˜¯å¦ä¸Šä¼ å®Œæˆï¼Ÿ\nâ€¢ è§„åˆ’ä¸‹åˆä»»åŠ¡å®‰æ’\nâ€¢ é€‚å½“ä¼‘æ¯æ”¾æ¾\nâ€¢ ä¿æŒé«˜æ•ˆçŠ¶æ€ ğŸš€"
                  }
                },
                {
                  "tag": "hr"
                },
                {
                  "tag": "div",
                  "text": {
                    "tag": "lark_md",
                    "content": "**è¿›åº¦æ£€æŸ¥ï¼š**\nâ€¢ ä¸Šåˆä»»åŠ¡å®Œæˆæƒ…å†µ\nâ€¢ ä¸‹åˆé‡ç‚¹äº‹é¡¹\nâ€¢ æ˜æ—¥è®¡åˆ’å‡†å¤‡"
                  }
                }
              ],
              "header": {
                "template": "wathet",
                "title": {
                  "content": "ğŸŒ… åˆåæé†’ | ",
                  "tag": "plain_text"
                }
              }
            }
          }'