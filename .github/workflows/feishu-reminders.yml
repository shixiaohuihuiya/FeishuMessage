name: Feishu Daily Reminder

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  schedule:
    # åŒ—äº¬æ—¶é—´æ—©ä¸Š9ç‚¹ (UTC+8) = UTCæ—¶é—´å‡Œæ™¨1ç‚¹
    - cron: '0 1 * * *'
    # åŒ—äº¬æ—¶é—´ä¸‹åˆ3ç‚¹ (UTC+8) = UTCæ—¶é—´æ—©ä¸Š7ç‚¹
    - cron: '0 7 * * *'

jobs:
  send-daily-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: Debug Info
        run: |
          echo "ğŸ” è°ƒè¯•ä¿¡æ¯:"
          echo "Event: ${{ github.event_name }}"
          echo "Schedule: ${{ github.event.schedule }}"
          echo "Current UTC: $(date -u)"
          echo "Current Beijing: $(TZ='Asia/Shanghai' date)"
          echo "Webhook URL configured: $([ -n '${{ secrets.FEISHU_WEBHOOK_URL }}' ] && echo 'YES' || echo 'NO')"

      - name: Simple Test Message
        run: |
          BEIJING_TIME=$(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')
          echo "â° å½“å‰åŒ—äº¬æ—¶é—´: $BEIJING_TIME"
          
          # ç®€å•çš„æµ‹è¯•æ¶ˆæ¯
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
            "${{ secrets.FEISHU_WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            -d '{
              "msg_type": "text",
              "content": {
                "text": "æµ‹è¯•æ¶ˆæ¯ - å¦‚æœæ”¶åˆ°æ­¤æ¶ˆæ¯è¯´æ˜æœºå™¨äººé…ç½®æ­£å¸¸\næ—¶é—´: '"$BEIJING_TIME"'\nè§¦å‘æ–¹å¼: '"${{ github.event_name }}"'"
              }
            }')
          
          # è§£æå“åº”
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          RESPONSE_BODY=$(echo "$RESPONSE" | head -n -1)
          
          echo "ğŸ“¡ HTTP çŠ¶æ€ç : $HTTP_CODE"
          echo "ğŸ“¨ å“åº”å†…å®¹: $RESPONSE_BODY"
          
          if [ "$HTTP_CODE" -eq 200 ]; then
            echo "âœ… æ¶ˆæ¯å‘é€æˆåŠŸï¼"
          else
            echo "âŒ æ¶ˆæ¯å‘é€å¤±è´¥"
          fi
